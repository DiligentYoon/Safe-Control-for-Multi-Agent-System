# Gemini 프로젝트 로그

## 요약

이 문서는 Gemini 에이전트와 함께 로봇 탐사 시뮬레이션 프로젝트를 수정하고 개선한 작업 내역을 기록합니다.

## 진행 상황 (2025-09-14)

### 1. 초기 코드베이스 분석

- 에이전트가 전체 Python 코드베이스를 분석하여 `worker.py`, `simulation.py`, `controller2.py` 등 각 파일의 역할을 파악했습니다.
- 프로젝트가 MPC(Model Predictive Control) 컨트롤러를 사용하는 로봇 탐사 시뮬레이터임을 확인했습니다.

### 2. CBF 기반 컨트롤러 구현

- 사용자 요청에 따라, 안전성(충돌 회피)을 우선으로 하는 **CBF(Control Barrier Functions)** 기반의 새로운 컨트롤러를 개발했습니다.
- 기존 MPC 컨트롤러를 유지한 채, 새로운 로직을 담을 `controller_cbf.py` 파일을 생성했습니다.
- `CBFController`는 다음과 같은 특징을 가지도록 구현되었습니다:
    - **QP(Quadratic Program)** 문제를 공식화하여 가장 안전한 제어 명령(`v`, `w`)을 찾습니다.
    - QP의 목표는 "이상적인" P-제어기의 출력을 최대한 따르는 것입니다.
    - QP의 제약 조건에는 제어 입력의 한계와 충돌 회피를 보장하는 CBF 부등식 제약이 포함됩니다.

### 3. 통합 및 개선

- **통합**: `simulation.py`가 기존 `ShortHorizonMPC` 대신 새로 만든 `CBFController`를 사용하도록 수정했습니다.
- **호환성 수정**:
    - `simulation.py`의 시각화 로직을 CBF 컨트롤러의 출력(예측 경로를 반환하지 않음)에 맞게 업데이트했습니다.
    - 통합 과정에서 발생한 `AttributeError`, `TypeError` 등의 여러 버그를 식별하고 수정했습니다.
- **제어 로직 개선**: 사용자 피드백에 따라 `CBFController` 내부의 이상적인 제어기(nominal controller)를 개선했습니다. 기준 속도(`v_ref`)를 상수 최대 속도에서 **목표 지점까지의 거리에 기반한 P-제어**로 변경하여, 로봇이 더 부드럽게 감속할 수 있도록 만들었습니다.

## 다음 단계

- 새로운 CBF 컨트롤러의 성능을 계속 테스트합니다.
- 최적의 성능을 위해 컨트롤러 파라미터(`k_v`, `k_w`, `gamma`)를 추가로 미세 조정합니다.
